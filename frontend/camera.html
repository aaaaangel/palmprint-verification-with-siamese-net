<!DOCTYPE html>
<html lang="ZH-CN">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <title>camera</title>
    <script src="js/webcam.js"></script>
    <link href="css/camera.css" rel="stylesheet" type="text/css" />
</head>
<body>

<div class="btn" id="return">Return</div>
<div id="my_camera"></div>
<div class="btn" id="take" onclick="take_snapshot()">Take Snapshot</div>

<div class="btn" id="save">Save</div>
<div id="my_result"></div>

<script src="js/jquery.min.js"></script>
<script language="JavaScript">
    Webcam.set({
        width: 240,
        height: 400,
        // crop_width: 240,
        // crop_height: 240
    });
    Webcam.attach( '#my_camera' );


    var data;
    var isAdd = sessionStorage.getItem('add');
    var name = sessionStorage.getItem('name');
    var maxId = sessionStorage.getItem('max');
    // var ip = "http://192.168.43.222:8080/";
    var ip = "https://192.168.43.55:8080/";

    function take_snapshot() {
        Webcam.snap( function(data_uri) {
            data = data_uri;
            // console.log(data);
            document.getElementById('my_result').innerHTML = '<img src="'+data_uri+'"/>';
            // console.log(data);
        } );
    }

    document.getElementById("save").addEventListener("click",function () {
        alert('Start processing');
        ajaxTemp(data);
    },false);

    document.getElementById("return").addEventListener("click",function () {
        window.location.href="index.html";
    },false);

    function ajaxTemp(pic){
        if(isAdd=='not'){
            $.ajax({
                type: "get",
                async: false,
                url: ip,
                data : {"type":5,"name":name, "url": pic},
                success:function(response){
                    // 返回结果， 是否为这个人
                    if(response == "success"){
                        alert("You are "+name);
                        window.location.href="index.html";
                    }
                    else{
                        alert(response);
                    }
                }
            });
        }
        else{
            // 添加掌纹
            $.ajax({
                type: "get",
                async: false,
                url: ip,
                data : {"type":4,"name":name,"url": pic, "hand": isAdd, 'max': maxId},
                success:function(response){
                    // 是否添加成功
                    if(response == "success"){
                        alert("Success!");
                        window.location.href="palmprint.html";
                    }
                    else{
                        alert(response);
                    }
                }
            });
        }
    }

</script>

<!--<a href="javascript:void(take_snapshot())">Take Snapshot</a>-->
</body>
</html>

